<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sweetHome.mapper.BoardMapper">

    <resultMap id="boardResultMap" type="com.sweetHome.vo.BoardVO">
        <id property="boardSeq" column="board_seq" />
        <result property="boardTitle" column="board_title" />
        <result property="boardContents" column="board_contents" />
        <result property="createdDate" column="created_date" />
        <result property="updatedDate" column="updated_date" />
        <result property="userSeq" column="user_seq" />
        <result property="communitySeq" column="community_seq" />
        <association property="community" javaType="com.sweetHome.vo.CommunityVO">
			<id property="communitySeq" column="community_seq" />
			<result property="communityName" column="community_name" />
			<result property="communityDescription" column="community_description" />
			<result property="createdDate" column="created_date" />
        </association>
        <association property="user" javaType="com.sweetHome.vo.UserVO">
			<id property="userSeq" column="user_seq" />
			<result property="userEmail" column="user_email" />
			<result property="userPw" column="user_pw" />
			<result property="userNickname" column="user_nickname" />
			<result property="phoneNumber" column="phone_number" />
			<result property="userName" column="user_name" />
			<result property="address" column="address" />
			<result property="addressDetail" column="address_detail" />
			<result property="provider" column="provider" />
			<result property="createdDate" column="created_date" />
			<result property="updatedDate" column="updated_date" />
			<result property="userRole" column="user_role" />
        </association>
        <collection property="boardImages" ofType="com.sweetHome.vo.BoardImagesVO">
        	<id property="boardImageSeq" column="board_image_seq" />
        	<result property="boardSeq" column="board_seq" />
        	<result property="oname" column="oname" />
        	<result property="sname" column="sname" />
        	<result property="fsize" column="fsize" />
        	<result property="fpath" column="fpath" />
        </collection>
        <collection property="recommend" ofType="com.sweetHome.vo.RecommendVO">
        	<id property="boardSeq" column="board_seq" />
        	<result property="userSeq" column="user_seq" />
        </collection>
    </resultMap>

	<select id="boardList" resultMap="boardResultMap" parameterType="int">
		select b.board_seq, b.board_title, u.user_nickname, b.updated_date, count(r.board_seq) as recommend
		from board b, recommend r, users u
		where b.board_seq = r.board_seq
		and b.user_seq = u.user_seq
		group by b.board_seq, b.board_title, u.user_nickname, b.updated_date
		order by b.board_seq desc
	</select>

    <select id="boardDetail" resultMap="boardResultMap" parameterType="int">
        select b.board_seq, b.board_title, b.board_contents, i.board_image_seq, i.board_seq, i.oname, i.sname, i.fsize, i.fpath, c.community_name, u.user_nickname, count(r.board_seq) as recommend
		from board b, board_images i, recommend r, community c, users u
		where b.board_seq = i.board_seq
		and b.board_seq = r.board_seq(+)
		and b.community_seq = c.community_seq
		and b.user_seq = u.user_seq
		and b.board_seq = #{boardSeq}
		group by b.board_seq, b.board_title, b.board_contents, i.board_image_seq, i.board_seq, i.oname, i.sname, i.fsize, i.fpath, c.community_name, u.user_nickname
    </select>
	
	<insert id="boardRecommend" parameterType="int">
		insert into recommend values (#{boardSeq}, #{userSeq});
	</insert>





















<!-- 

    <insert id="insertUsers" parameterType="com.sweetHome.vo.UserVO">
        INSERT INTO Users (user_seq, user_email, user_pw, user_nickname, phone_number, user_name, address, address_detail, provider)
        VALUES (users_seq.NEXTVAL, #{userEmail}, #{userPw}, #{userNickname}, #{phoneNumber}, #{userName}, #{address}, #{addressDetail}, #{provider})
    </insert>

    <select id="selectUser" parameterType="int" resultMap="userResultMap">
        SELECT * FROM Users WHERE user_seq = #{userSeq}
    </select>

    <select id="selectAllUsers" resultMap="userResultMap">
        SELECT * FROM Users
    </select>

    <select id="selectUsersByEmail" parameterType="String" resultMap="userResultMap">
        SELECT * FROM Users WHERE user_email = #{userEmail}
    </select>
    
    <update id="updateUser" parameterType="com.sweetHome.vo.UserVO">
        UPDATE Users SET
            user_email = #{userEmail},
            user_pw = #{userPw},
            user_nickname = #{userNickname},
            phone_number = #{phoneNumber},
            user_name = #{userName},
            address = #{address},
            address_detail = #{addressDetail},
            provider = #{provider},
            created_date = #{createdDate},
            updated_date = #{updatedDate},
            user_role = #{userRole}
        WHERE user_seq = #{userSeq}
    </update>

    <delete id="deleteUser" parameterType="int">
        DELETE FROM Users WHERE user_seq = #{userSeq}
    </delete>
 -->
</mapper>